---
weight: 20
title: "DPAPI examples"
---

# DPAPI examples

<span style="font-size:12pt; color:red">Note that this is a living document and the following is subject to change. </span>

This page gives simple examples of the **user written** *config.yaml* file alongside the working config file generated by `FAIR run`. Note that **the Data Pipeline API will take the working config file as an input**.

## Empty code run

#### User written *config.yaml*

```yaml
run_metadata:
  description: An empty code run
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/FAIRDataPipeline/FDP_validation/
  script: |- 
    R -f simple_working_examples/empty_script.R ${{CONFIG_DIR}}
```

#### Working *config.yaml*

`fair run` should create a working *config.yaml* file, which is read by the Data Pipeline API. In this example, the working *config.yaml* file is pretty much identical to the original *config.yaml* file, only `${{CONFIG_DIR}}` is replaced by the directory in which the working *config.yaml* file resides.

```yaml
run_metadata:
  description: An empty code run
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/FAIRDataPipeline/FDP_validation/
  script: |- 
    R -f simple_working_examples/empty_script.R /Users/SoniaM/datastore/coderun/20210511-231444/
  latest_commit: 221bfe8b52bbfb3b2dbdc23037b7dd94b49aaa70
  remote_repo: https://github.com/FAIRDataPipeline/FDP_validation
```

#### Submission script (R)

```r
library(rFDP)

# Initialise Code Run
config <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "config.yaml")
script <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "script.sh")
handle <- initialise(config, script)

finalise(handle)
```

## Write data product (HDF5)

#### User written *config.yaml*

```yaml
run_metadata:
  description: Write an array
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/FAIRDataPipeline/FDP_validation/
  script: |- 
    R -f simple_working_examples/write_array.R ${{CONFIG_DIR}}

write:
- data_product: test/array
  description: test array with simple data
```

#### Working *config.yaml*

`fdp run` should create a working *config.yaml* file, which is read by the Data Pipeline API. In this example, the working *config.yaml* file is pretty much identical to the original *config.yaml* file, only `${{CONFIG_DIR}}` is replaced by the directory in which the working *config.yaml* file resides.

```yaml
run_metadata:
  description: Write an array
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/FAIRDataPipeline/FDP_validation/
  script: |- 
    R -f simple_working_examples/write_array.R /Users/SoniaM/datastore/coderun/20210511-231444/
  public: true
  latest_commit: 221bfe8b52bbfb3b2dbdc23037b7dd94b49aaa70
  remote_repo: https://github.com/FAIRDataPipeline/FDP_validation

write:
- data_product: test/array
  description: test array with simple data
  use:    
    version: 0.1.0
```

Note that, although `use:` is reserved for aliasing in the user-written config, for simplicity the CLI will always write `version` here.

Note also that by default, the CLI will write `public: true` to `run_metadata:`. The user is however free to specify `public: false` for individual writes.

#### Submission script (R)

```r
library(rFDP)

# Initialise Code Run
config <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "config.yaml")
script <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "script.sh")
handle <- initialise(config, script)

df <- data.frame(a = 1:2, b = 3:4)
rownames(df) <- 1:2

write_array(array = as.matrix(df),
            handle = handle,
            data_product = "test/array",
            component = "component1/a/s/d/f/s",
            description = "Some description",
            dimension_names = list(rowvalue = rownames(df),
                                   colvalue = colnames(df)),
            dimension_values = list(NA, 10),
            dimension_units = list(NA, "km"),
            units = "s")

finalise(handle)
```

## Read data product (HDF5)

#### User written *config.yaml*

```yaml
run_metadata:
  description: Read an array
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/FAIRDataPipeline/FDP_validation/
  script: |- 
    R -f simple_working_examples/read_array.R ${{CONFIG_DIR}}

read:
- data_product: test/array
```

#### Working *config.yaml*

`fdp run` should create a working *config.yaml* file, which is read by the Data Pipeline API. In this example, the working *config.yaml* file is pretty much identical to the original *config.yaml* file, only `${{CONFIG_DIR}}` is replaced by the directory in which the working *config.yaml* file resides.

```yaml
run_metadata:
  description: Read an array
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/FAIRDataPipeline/FDP_validation/
  script: |- 
    R -f simple_working_examples/read_array.R /Users/SoniaM/datastore/coderun/20210511-231444/
  latest_commit: 221bfe8b52bbfb3b2dbdc23037b7dd94b49aaa70
  remote_repo: https://github.com/FAIRDataPipeline/FDP_validation

read:
- data_product: test/array
  use: 
    version: 0.1.0
```

#### Submission script (R)

```r
library(rFDP)

# Open the connection to the local registry with a given config file
config <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "config.yaml")
script <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "script.sh")
handle <- initialise(config, script)

data_product <- "test/array"
component <- "component1/a/s/d/f/s"

dat <- read_array(handle = handle,
                  data_product = data_product,
                  component = component)

finalise(handle)
```

## Write data product (csv)

#### User written *config.yaml*

```yaml
run_metadata:
  description: Write csv file
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/FAIRDataPipeline/FDP_validation/
  script: |-
    R -f simple_working_examples/write_csv.R ${{CONFIG_DIR}}

write:
- data_product: test/csv
  description: test csv file with simple data
  file_type: csv
```

#### Working *config.yaml*

```yaml
run_metadata:
  description: Write csv file
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/ 
  local_repo: /Users/Soniam/Desktop/git/FAIRDataPipeline/FDP_validation/
  script: |-
    R -f simple_working_examples/write_csv.R /Users/SoniaM/datastore/coderun/20210511-231444/
  public: true
  latest_commit: 221bfe8b52bbfb3b2dbdc23037b7dd94b49aaa70
  remote_repo: https://github.com/FAIRDataPipeline/FDP_validation

write:
- data_product: test/csv
  description: test csv file with simple data
  file_type: csv
  use:    
    version: 0.0.1
```

#### Submission script (R)

```r
library(rFDP)

# Open the connection to the local registry with a given config file
config <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "config.yaml")
script <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "script.sh")
handle <- initialise(config, script)

df <- data.frame(a = 1:2, b = 3:4)
rownames(df) <- 1:2

path <- link_write(handle, "test/csv")

write.csv(df, path)

finalise(handle)
```

## Read data product (csv)

#### User written *config.yaml*

```yaml
run_metadata:
  description: Read csv file
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/FAIRDataPipeline/FDP_validation/
  script: |-
    R -f simple_working_examples/read_csv.R ${{CONFIG_DIR}}

read:
- data_product: test/csv
```

#### Working *config.yaml*

```yaml
run_metadata:
  description: Read csv file
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/FAIRDataPipeline/FDP_validation/
  script: |-
    R -f simple_working_examples/read_csv.R /Users/SoniaM/datastore/coderun/20210511-231444/
  latest_commit: 221bfe8b52bbfb3b2dbdc23037b7dd94b49aaa70
  remote_repo: https://github.com/FAIRDataPipeline/FDP_validation

read:
- data_product: test/csv
  use:
    version: 0.0.1
```

#### Submission script (R)

```r
library(rFDP)

# Open the connection to the local registry with a given config file
config <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "config.yaml")
script <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "script.sh")
handle <- initialise(config, script)

path <- link_read(handle, "test/csv")
df <- read.csv(path)

finalise(handle)
```

## Write data product (point estimate)

#### User written *config.yaml*

```yaml
run_metadata:
  description: Write point estimate
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/SCRC/SCRCdata/
  script: |-
    R -f simple_working_examples/write_point_estimate.R ${{CONFIG_DIR}}

write:
- data_product: test/estimate/asymptomatic-period
  description: asymptomatic period
```

#### Working *config.yaml*

```yaml
run_metadata:
  description: Write point estimate
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/SCRC/SCRCdata/
  script: |-
    R -f simple_working_examples/write_point_estimate.R /Users/SoniaM/datastore/coderun/20210511-231444/
  public: true
  latest_commit: 221bfe8b52bbfb3b2dbdc23037b7dd94b49aaa70
  remote_repo: https://github.com/FAIRDataPipeline/FDP_validation

write:
- data_product: test/estimate/asymptomatic-period
  description: asymptomatic period
  use:    
    version: 0.0.1
```

#### Submission script (R)

```r
library(rFDP)

# Open the connection to the local registry with a given config file
config <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "config.yaml")
script <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "script.sh")
handle <- initialise(config, script)

write_estimate(value = 9,
               handle = handle,
               data_product = "test/distribution/asymptomatic-period",
               component = "asymptomatic-period",
               description = "asymptomatic period")

finalise(handle)
```

## Read data product (point estimate)

#### User written *config.yaml*

```yaml
run_metadata:
  description: Read point estimate
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/SCRC/SCRCdata/
  script: |-
    R -f simple_working_examples/read_point_estimate.R ${{CONFIG_DIR}}

read:
- data_product: test/estimate/asymptomatic-period
```

#### Working *config.yaml*

```yaml
run_metadata:
  description: Read point estimate
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/SCRC/SCRCdata/
  script: |-
    R -f simple_working_examples/read_point_estimate.R /Users/SoniaM/datastore/coderun/20210511-231444/
  latest_commit: 221bfe8b52bbfb3b2dbdc23037b7dd94b49aaa70
  remote_repo: https://github.com/FAIRDataPipeline/FDP_validation

read:
- data_product: test/estimate/asymptomatic-period
  use:
    version: 0.0.1
```

#### Submission script (R)

```r
library(rFDP)

# Open the connection to the local registry with a given config file
config <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "config.yaml")
script <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "script.sh")
handle <- initialise(config, script)

read_estimate(handle = handle,
              data_product = "test/distribution/asymptomatic-period",
              component = "asymptomatic-period")

finalise(handle)
```

## Write data product (distribution)

#### User written *config.yaml*

```yaml
run_metadata:
  description: Write distribution
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/SCRC/SCRCdata/
  script: |-
    R -f simple_working_examples/write_distribution.R ${{CONFIG_DIR}}

write:
- data_product: test/distribution/symptom-delay
  description: Estimate of symptom delay
```

#### Working *config.yaml*

```yaml
run_metadata:
  description: Write distribution
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/SCRC/SCRCdata/
  script: |-
    R -f simple_working_examples/write_distribution.R /Users/SoniaM/datastore/coderun/20210511-231444/
  public: true
  latest_commit: 221bfe8b52bbfb3b2dbdc23037b7dd94b49aaa70
  remote_repo: https://github.com/FAIRDataPipeline/FDP_validation

write:
- data_product: test/distribution/symptom-delay
  description: Estimate of symptom delay
  use:    
    version: 0.0.1
```

#### Submission script (R)

```r
library(rFDP)

# Open the connection to the local registry with a given config file
config <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "config.yaml")
script <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "script.sh")
handle <- initialise(config, script)

write_distribution(handle = handle,
                   data_product = "test/distribution/symptom-delay",
                   component = "symptom-delay",
                   distribution = "Gaussian",
                   parameters = list(mean = -16.08, SD = 30),
                   description = "symptom delay")

finalise(handle)
```

## Read data product (distribution)

#### User written *config.yaml*

```yaml
run_metadata:
  description: Read distribution
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/SCRC/SCRCdata/
  script: |-
    R -f simple_working_examples/read_distribution.R ${{CONFIG_DIR}}

read:
- data_product: test/distribution/symptom-delay
```

#### Working *config.yaml*

```yaml
run_metadata:
  description: Read distribution
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/SCRC/SCRCdata/
  latest_commit: 221bfe8b52bbfb3b2dbdc23037b7dd94b49aaa70
  remote_repo: https://github.com/FAIRDataPipeline/FDP_validation
  script: |-
    R -f simple_working_examples/read_distribution.R /Users/SoniaM/datastore/coderun/20210511-231444/
  latest_commit: 221bfe8b52bbfb3b2dbdc23037b7dd94b49aaa70
  remote_repo: https://github.com/FAIRDataPipeline/FDP_validation

read:
- data_product: test/distribution/symptom-delay
  use:
    version: 0.0.1
```

#### Submission script (R)

```r
library(rFDP)

# Open the connection to the local registry with a given config file
config <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "config.yaml")
script <- file.path(Sys.getenv("FDP_CONFIG_DIR"), "script.sh")
handle <- initialise(config, script)

read_distribution(handle = handle,
                  data_product = "test/distribution/symptom-delay",
                  component = "symptom-delay")

finalise(handle)
```

## Attach issue to component

## Attach issue to whole data product

## Attach issue to config

## Attach issue to submission script

## Attach issue to GitHub repository

## Attach issue to external object
This is not something we want to do.
## Attach issue to code run
This might be something we want to do in the future.

## Delete DataProduct (optionally) if identical to previous version

## Delete CodeRun (optionally) if nothing happened
*That is, if no output was created and no issue was raised*

## CodeRun with aliases (`use` block example)

#### User written *config.yaml*

```yaml
run_metadata:
  description: A test model
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: SCRC
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  local_repo: /Users/Soniam/Desktop/git/SCRC/SCRCdata
  script: |- 
    R -f inst/SCRC/scotgov_management/submission_script.R ${{CONFIG_DIR}}

read:
- data_product: human/population
  use:
    namespace: johnsmith
    data_product: scotland/human/population

write:
- data_product: human/outbreak-timeseries
  description: data product description
  use:
    data_product: scotland/human/outbreak-timeseries
- data_product: human/outbreak/simulation_run
  description: another data product description
  use:
    data_product: human/outbreak/simulation_run-${{RUN_ID}}
```

#### Working *config.yaml*

`fair run` should create a working *config.yaml* file, which is read by the Data Pipeline API. In this example, the working *config.yaml* file is pretty much identical to the original *config.yaml* file, only `${{CONFIG_DIR}}` is replaced by the directory in which the working *config.yaml* file resides.

```yaml
run_metadata:
  description: A test model
  local_data_registry_url: https://localhost:8000/api/
  remote_data_registry_url: https://data.scrc.uk/api/
  default_input_namespace: soniamitchell
  default_output_namespace: soniamitchell
  write_data_store: /Users/SoniaM/datastore/
  public: true
  local_repo: /Users/Soniam/Desktop/git/SCRC/SCRCdata
  latest_commit: 221bfe8b52bbfb3b2dbdc23037b7dd94b49aaa70
  remote_repo: https://github.com/ScottishCovidResponse/SCRCdata
  script: |- 
    R -f inst/SCRC/scotgov_management/submission_script.R /Users/SoniaM/datastore/coderun/20210511-231444/

read:
- data_product: human/population
  use:
    data_product: scotland/human/population
    version: 0.1.0
    namespace: johnsmith

write:
- data_product: human/outbreak-timeseries
  description: data product description
  use:
    data_product: scotland/human/outbreak-timeseries
    version: 0.1.0
- data_product: human/outbreak/simulation_run
  description: another data product description
  use:
    data_product: human/outbreak/simulation_run-${{RUN_ID}}    
    version: 0.1.0
```
